<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Фид с тегом и скелетоном</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 900px; margin: 40px auto; padding: 0 20px; line-height: 1.6; }
    .post { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #fff; }
    .post img { max-width: 100%; height: auto; border-radius: 4px; margin-bottom: 16px; }
    h2 a { color: #0066cc; text-decoration: none; }
    h2 a:hover { text-decoration: underline; }
    .date { color: #666; font-size: 0.9em; margin: 8px 0; }

    .skel { background: linear-gradient(90deg, #eee 25%, #ddd 50%, #eee 75%); background-size: 200% 100%; animation: pulse 1.5s infinite; }
    @keyframes pulse { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
    .skel-line { height:1.2em; border-radius:4px; margin:0.6em 0; }
    .skel-line.w-90{width:90%}.skel-line.w-80{width:80%}.skel-line.w-70{width:70%}
    .skel-img { height:180px; border-radius:8px; width:100%; margin-bottom:12px; }
    .post-skel { margin:30px 0; padding:20px; border:1px solid #eee; border-radius:8px; }
  </style>
</head>
<body>
  <h1>Посты с тегом «новости»</h1>
  <div id="feed-destination"></div>

  <script>
  const FEED_DEST = '#feed-destination';
  const MAX_POSTS = 5;
  const TAG = 'Текст';

  const skeleton = `
    <div class="post-skel"><div class="skel skel-img"></div><div class="skel skel-line w-90"></div><div class="skel skel-line w-70"></div><div class="skel skel-line w-80"></div></div>
  `.repeat(3);

  document.querySelector(FEED_DEST).innerHTML = skeleton;

  fetch('https://corsproxy.io/?' + encodeURIComponent('https://pavel.live/rss-feed-633178312921.xml'))
    .then(r => r.text())
    .then(xml => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(xml, 'text/xml');
      const items = Array.from(doc.querySelectorAll('item'));

      const filtered = items
        .filter(item => {
          const cats = item.querySelectorAll('category');
          return Array.from(cats).some(cat => cat.textContent.trim() === TAG);
        })
        .sort((a, b) => new Date(b.querySelector('pubDate')?.textContent || 0) - new Date(a.querySelector('pubDate')?.textContent || 0))
        .slice(0, MAX_POSTS);

      let html = '';
      filtered.forEach(item => {
        const title   = item.querySelector('title')?.textContent || '';
        const link    = item.querySelector('link')?.textContent || '#';
        const pubDate = item.querySelector('pubDate')?.textContent || '';
        const desc    = item.querySelector('description')?.textContent || '';
        const img     = item.querySelector('enclosure')?.getAttribute('url') || '';

        html += `
          <div class="post">
            ${img ? `<img src="${img}" alt="">` : ''}
            <h2><a href="${link}" target="_blank">${title}</a></h2>
            <div class="date">${new Date(pubDate).toLocaleDateString('ru-RU', { day: '2-digit', month: 'long', year: 'numeric' })}</div>
            <div>${desc}</div> 
          </div>
        `;
      });

      document.querySelector(FEED_DEST).innerHTML = html || `<p>Постов с тегом «${TAG}» нет</p>`;
    })
    .catch(() => {
      document.querySelector(FEED_DEST).innerHTML = '<p style="color:red">Ошибка загрузки</p>';
    });
  </script>
</body>
</html>